{% extends "layout.html" %}
{% block title %}Gestión de Personas{% endblock %}
{% block content %}
<style>
body {
    background:
        url("{{ url_for('static', filename='media/personas.png') }}") center center no-repeat;
    background-size: cover;
}
</style>
<h1 class="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-extrabold mb-4 sm:mb-6 text-white text-center bg-gradient-to-r from-purple-900 via-blue-900 to-purple-900 bg-opacity-90 rounded-lg sm:rounded-xl p-3 sm:p-4 md:p-6 mx-auto max-w-fit border-2 sm:border-3 md:border-4 border-purple-400 shadow-lg sm:shadow-xl md:shadow-2xl hover:scale-105 transition-transform" style="text-shadow: 2px 2px 4px rgba(0,0,0,1), 0 0 15px rgba(255,255,255,0.3);">
    <span class="hidden sm:inline">👥</span> Gestión de Personas <span class="hidden sm:inline">📋</span>
</h1>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
    
    <!-- Columna del Formulario -->
    <div class="lg:col-span-1">
        <div class="card bg-white bg-opacity-50 backdrop-blur-md border border-white border-opacity-40">
            <h2 class="text-lg sm:text-xl font-bold mb-4">
                {% if 'user_id' in session %}Crear Nueva Persona{% else %}Formulario de Registro{% endif %}
            </h2>
            <form action="{{ url_for('crear_persona') }}" method="POST" class="space-y-3 sm:space-y-4">                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                    <div>
                        <label for="nom1" class="block text-sm font-medium text-gray-700">Primer Nombre*</label>
                        <input type="text" name="nom1" id="nom1" required placeholder="Ej: Juan" 
                               value="{{ request.form.get('nom1', '') if request.method == 'POST' else '' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-white bg-opacity-60 focus:bg-opacity-90 placeholder-gray-400">
                    </div>
                    <div>
                        <label for="nom2" class="block text-sm font-medium text-gray-700">Segundo Nombre</label>
                        <input type="text" name="nom2" id="nom2" placeholder="Ej: Carlos" 
                               value="{{ request.form.get('nom2', '') if request.method == 'POST' else '' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-white bg-opacity-60 focus:bg-opacity-90 placeholder-gray-400">
                    </div>
                    <div>
                        <label for="apell1" class="block text-sm font-medium text-gray-700">Primer Apellido*</label>
                        <input type="text" name="apell1" id="apell1" required placeholder="Ej: García" 
                               value="{{ request.form.get('apell1', '') if request.method == 'POST' else '' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-white bg-opacity-60 focus:bg-opacity-90 placeholder-gray-400">
                    </div>
                    <div>
                        <label for="apell2" class="block text-sm font-medium text-gray-700">Segundo Apellido</label>
                        <input type="text" name="apell2" id="apell2" placeholder="Ej: López" 
                               value="{{ request.form.get('apell2', '') if request.method == 'POST' else '' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-white bg-opacity-60 focus:bg-opacity-90 placeholder-gray-400">
                    </div>
                </div>
                <div>
                    <label for="cedula" class="block text-sm font-medium text-gray-700">Cédula*</label>
                    <input type="text" name="cedula" id="cedula" required placeholder="Ej: 1234567890" 
                           value="{{ request.form.get('cedula', '') if request.method == 'POST' else '' }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-white bg-opacity-80 focus:bg-opacity-100 placeholder-gray-400">
                </div>
                <div>
                    <label for="correo" class="block text-sm font-medium text-gray-700">Correo Electrónico*</label>
                    <input type="email" name="correo" id="correo" required 
                           value="{{ request.form.get('correo', '') if request.method == 'POST' else '' }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-white bg-opacity-80 focus:bg-opacity-100">
                </div>
                <div>
                    <label for="direccion" class="block text-sm font-medium text-gray-700">Dirección</label>
                    <input type="text" name="direccion" id="direccion" 
                           value="{{ request.form.get('direccion', '') if request.method == 'POST' else '' }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-white bg-opacity-80 focus:bg-opacity-100">
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                    <div>
                        <label for="tele" class="block text-sm font-medium text-gray-700">Teléfono</label>
                        <input type="tel" name="tele" id="tele" 
                               value="{{ request.form.get('tele', '') if request.method == 'POST' else '' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-white bg-opacity-80 focus:bg-opacity-100">
                    </div>
                    <div>
                        <label for="movil" class="block text-sm font-medium text-gray-700">Móvil</label>
                        <input type="tel" name="movil" id="movil" 
                               value="{{ request.form.get('movil', '') if request.method == 'POST' else '' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-white bg-opacity-80 focus:bg-opacity-100">
                    </div>
                </div>
                <div>
                    <label for="fecha_nac" class="block text-sm font-medium text-gray-700">Fecha de Nacimiento</label>
                    <input type="date" name="fecha_nac" id="fecha_nac" 
                           value="{{ request.form.get('fecha_nac', '') if request.method == 'POST' else '' }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-white bg-opacity-80 focus:bg-opacity-100">
                </div>                
                              
                <button type="submit" class="w-full btn btn-primary text-sm sm:text-base">Guardar Persona</button>
                <div class="mt-3 sm:mt-4 text-center">
                <a href="{{ url_for('gestion_personas') }}" class="btn btn-secondary text-sm sm:text-base">Cancelar</a> 
                </div> 
            </form>
        </div>
    </div>
    
    <!-- Columna de la Tabla (Solo visible si el usuario está logueado) -->
    {% if 'user_id' in session %}
    <div class="lg:col-span-2">
        <div class="card bg-white bg-opacity-50 backdrop-blur-md border border-white border-opacity-40">
            <h2 class="text-lg sm:text-xl font-bold mb-4">Personas Registradas</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase">Nombre</th>
                            <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase hidden sm:table-cell">Correo</th>
                            <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado</th>
                            <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase">Acciones</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for persona in personas %}
                        <tr>
                            <td class="px-2 sm:px-4 py-2 sm:py-4 whitespace-nowrap text-sm">{{ persona.nom1 }} {{ persona.apell1 }}</td>
                            <td class="px-2 sm:px-4 py-2 sm:py-4 whitespace-nowrap text-sm hidden sm:table-cell">{{ persona.correo }}</td>
                            <td class="px-2 sm:px-4 py-2 sm:py-4 whitespace-nowrap">
                                {% if persona.estado %}
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Activo</span>
                                {% else %}
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Inactivo</span>
                                {% endif %}
                            </td>
                            <td class="px-2 sm:px-4 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-medium">
                                <div class="flex flex-col sm:flex-row sm:space-x-2 space-y-1 sm:space-y-0">
                                    <a href="{{ url_for('editar_persona', id=persona.Idpersona) }}" class="btn bg-blue-500 hover:bg-blue-600 text-white text-xs">Modificar</a>
                                    <a href="{{ url_for('inhabilitar_persona', id=persona.Idpersona) }}" class="btn {{ 'btn-danger' if persona.estado else 'btn-primary' }} text-xs">
                                        {{ 'Inhabilitar' if persona.estado else 'Habilitar' }}
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" class="text-center py-4 text-gray-500 text-sm">No hay personas registradas.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}